<!DOCTYPE html>
<html lang="en">
<head>

  <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>

  <script type="text/javascript">

    $(function(){
  
      changingTrack = false;
      trackStarted = false;


      function nextTrack(){
        if (changingTrack) {
          return;
        }
        changingTrack = true;

        $.ajax({
          url: '/room/myroom/top',
          type: 'DELETE',
          success: function(trackId){
            DZ.player.playTracks([trackId]);
          }
        });
      };

      function onPlayerPos(position){
        // Pos > 0 : track started
        if (position > 0 && !trackStarted) {
          trackStarted = true;
          changingTrack = false; // Now, nextTrack can be called again
        }

        // Pos = 0 and track started => it has ended
        if (position == 0 && trackStarted) {
          trackStarted = false;
          nextTrack();
        }
      };

      function onPlayerLoaded() {

        DZ.Event.subscribe('player_position', function(pos){
          onPlayerPos(pos[0]);
        });

        nextTrack();
      }

      DZ.init({
        appId  : '133181',
        channelUrl : 'http://playlist.mru2.com/channel.html',
        player : {
          container : 'player',
          cover : true,
          width : 1000,
          height : 80,
          playlist: false,
          onload : onPlayerLoaded
        }
      });

      DZ.login(function(response) {
        if (response.authResponse) {
          console.log('Welcome!  Fetching your information.... ');
          DZ.api('/user/me', function(response) {
            console.log('Good to see you, ' + response.name + '.');
          });
        } else {
          console.log('User cancelled login or did not fully authorize.');
        }
      }, {perms: 'manage_library,delete_library'});

    });

  </script>
</head>

<body>

  <h1>Music player</h1>

  <div id="dz-root"></div>
  <script type="text/javascript" src="http://cdn-files.deezer.com/js/min/dz.js"></script>

  <div id="player" style="width:100%;" align="center"></div>

</body>
</html>